# 目的

使用Langchain来完成一个复杂的链，能够使用内存组件，进行结构化输出。

# 概念

LangChain 的主要组件包括:模型(Models)、提示(Prompts)、索引(Indexes)、链(Chains)、代理(Agents)、内存(Memory)。

链是 LangChain 中的一个核心概念,它允许将多个组件(如提示、模型、解析器等)组合在一起,形成一个端到端的调用序列,用于完成复杂的任务。

代理(Agent)是一种能够使用工具并决定下一步行动的实体。它可以根据用户输入和当前状态,选择适当的工具来执行任务,实现更复杂的交互和问题解决。

提示模板(Prompt Template)是一种结构化的方式来创建提示。允许定义一个带有占位符的模板,然后在运行时用实际值填充这些占位符,从而生成完整的提示。

内存(Memory)组件用于在对话或交互过程中存储和检索历史信息。它允许模型或应用程序记住之前的交互,从而实现更连贯和上下文相关的对话。

输出解析器(Output Parser)是用来将语言模型的原始输出转换为结构化格式的组件。它可以将文本输出解析为特定的数据结构,如列表、字典或自定义对象。

某些 LangChain 聊天模型支持 .with_structured_output() 方法。此方法只需要一个架构作为输入，并返回一个字典或 Pydantic 对象。

# 结果

## 使用json输出

主题: 日系女友

Completion Tokens: 535

Prompt Tokens: 164

Total Tokens: 699

小说摘要:

时间: 2023年的秋天

地点: 东京的一所大学校园内

人物: 拓也，一个二年级大学生，及他的日系女友美咲

起因: 拓也和美咲相识于大学的摄影社活动，因共同的兴趣而逐渐交往，他们决定一起参加秋季摄影比赛。

经过: 拓也和美咲在东京的各个街区拍摄照片，他们特别喜爱秋日的银杏树。为了捕捉完美的瞬间，他们清晨出发，寻找阳光穿透树叶的角度。一天，两人在拍摄时偶然发现了一个隐秘的小巷，尽头是一座久无人住的百年宅邸。美咲对那里的历史充满了好奇，拓也则被废弃建筑的美感所吸引。他们开始定期造访，并决定以此为主题提交作品。       

结果: 在摄影比赛中，拓也和美咲的作品因其独特的视角和柔和的光影对比获得了大奖。这次经历不仅加深了他们对艺术的理解，也让他们的感情更加深厚。他们承诺将继续探索更多被遗忘的美景。

小说正文:
拓也一直相信摄影是捕捉瞬间情感的艺术，而美咲则认为每一张照片背后都有一个动人的故事。自从他们在大学里相遇，摄影便成为连接他们的纽带。这个秋天，他们开始频繁 地出门，用相机记录下城市的每一个角落。某个星期天的清晨，薄雾弥漫，阳光柔和，他们沿着不知名的小路走进了一片未被开发的区域。那里，银杏树叶金黄一片，掩映着一 座老宅。这是美咲最爱的场景，她感受到了那个时期的人们在此生活的痕迹。拓也则被她的热情感染，用镜头纪录一切。多次探访后，他们不仅拍摄到了令人叹为观止的照片，还重新定义了彼此的关系。比赛的结果似乎已不再重要，他们用镜头发现的，是一段意想不到的旅程与两颗逐渐靠近的心。